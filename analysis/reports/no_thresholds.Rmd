---
title: "No thresholds"
output: html_notebook
---

```{r setup}
library(drake)
library(isds)
library(ggplot2)
## Set up the cache and config
db <- DBI::dbConnect(RSQLite::SQLite(), here::here("drake", "drake-cache.sqlite"))
cache <- storr::storr_dbi("datatable", "keystable", db)
```

```{r load things}

all_ids <- cached(cache = cache) [ which(substr(cached(cache = cache), 0, 2) == "id")]
# for(i in 1:length(all_ids)) {
# loadd(all_ids[i], cache = cache, character_only = T)
# }

ids <- lapply(all_ids, readd, cache = cache, character_only  = T)
```

```{r get stats}

get_result_not <- function(integrated_density) {
  result <- data.frame(npeaks = count_peaks(integrated_density),
                       dat_type = get_type(integrated_density),
                       datname = get_datname(integrated_density),
                       stdev = get_stdev(integrated_density),
                       ratio_mean = get_mode_ratio(integrated_density, what = "mean"),
                       ratio_sd = get_mode_ratio(integrated_density, what = "stdev"),
                       scaled_e_change = get_scaled_e_change(integrated_density),
                       mean_p = get_mean_p(integrated_density)
  )
  
  result$dat_type <- as.character(result$dat_type)
  
  return(result)
}

result <- lapply(ids, get_result_not)
result <- dplyr::bind_rows(result)
```

```{r cleanup}
DBI::dbDisconnect(db)
```
